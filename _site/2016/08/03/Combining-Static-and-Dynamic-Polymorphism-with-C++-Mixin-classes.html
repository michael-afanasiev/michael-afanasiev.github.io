<!DOCTYPE html>
<html>
  <head>
      
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://yourdomain.com/2016/08/03/Combining-Static-and-Dynamic-Polymorphism-with-C++-Mixin-classes.html">
  <link rel="alternate" type="application/rss+xml" title="YachtHeavy" href="http://yourdomain.com/feed.xml">

<!-- Google font -->

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto Sans">

<!-- font awesome -->

<link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">

</head>


  

  

  </head>

  <body>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Combining Static and Dynamic Polymorphism with C++ Mixin classes</title>
  <meta name="description" content="This is the first in a series of blog posts which describe an interesting way to combine both dynamic and static polymorphism. My day job is as a PhD student...">
</head>


  <div class="wrapper">
          <header class="post-header">

    <center><div class="post-title" itemprop="name headline">Combining Static and Dynamic Polymorphism with C++ Mixin classes</div>

		<div class="post-meta"><i class="fa fa-calendar-o"></i> <time datetime="03 Aug 2016" itemprop="datePublished">Aug 3 2016</time>

		
		<br>
		<i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-pulse"></i></span>˚C</span>
	</div>

        
        <div class="post-tags">
        
	</div>
    </center>
    
</header>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<div class="post-content">
    <center>
	
    </center>
	<h2>Directory</h2>
</div>

<div id="category"></div>

<div class="post-content" itemprop="articleBody">
    <p>This is the first in a series of blog posts which describe an interesting way to combine both dynamic and static polymorphism. My day job is as a PhD student in Geophysics, focusing on Full Waveform Inversion, and the application space will be one I’m personally familiar with: numerical analysis using the finite element method. This being said, the techniques presented can be applied to a range of problems, numerical or otherwise. Please read on for a (hopefully) informative and (maybe even) entertaining look at the <code class="highlighter-rouge">C++</code> Template Mixin Pattern.</p>

<h2 id="part-1-problem-statement">Part 1: Problem statement</h2>
<p>The struggle is real. We often want to provide users with dynamic polymorphic behaviour, but would also like to leverage the speed and compile-time checking available with template based static polymorphism. Right off the bat, suggesting that we combine the two seems almost oxymoronic. I mean “dynamic” and “static” are the names of the concepts themselves right? Well, yes, and when we get to the end you’ll notice that a small compromise was made. However, I hope to convince you that this compromise is negligible in relation to what you gain.</p>

<p>Before we get to finite elements, I’d like to introduce mixin templates in a friendlier way. Say we have a cat and a dog, and we want to make them do what they do best: occasionally make sounds. Easy.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;memory&gt;
</span> 
<span class="k">class</span> <span class="nc">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Woof."</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Meow."</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
 
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;&gt;</span> <span class="n">animals</span><span class="p">;</span>
  <span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="p">());</span>
  <span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="p">());</span>
 
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">animal</span><span class="o">:</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">vocalize</span><span class="p">();</span> <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="p">}</span></code></pre></figure>

<p>If you compile and run this (ensuring to use <code class="highlighter-rouge">-std=c++11</code>) you’ll get a simple conversation:</p>

<p><code class="highlighter-rouge">Woof. Meow.</code></p>

<p>This is about as simple as you can get. If you’d like, you can easily make this into something that’s polymorphic at runtime by adding a factory function that returns one class or the other based on some command line arguments. We also find no problem in adding an arbitrary number of animals and operating on them one at a time in our vector.</p>

<p>Now, say that you wanted to expand your pets’ minds. Maybe you sat down with them and watched David Attenborough wax poetic about the arctic night, and now want to have a conversation about it. This will require modifying their original responses to include their thoughts on BBC: Frozen Planet. Below I’ll jump straight into using mixins to accomplish this, even though it can be accomplished (at this stage) by class pointers. Once I get to the finite-element example, we’ll revisit that decision.</p>

<h2 id="part-2-compile-time-polymorphism-with-template-mixins">Part 2: Compile time polymorphism with template mixins</h2>

<p>After the show, you guys might have a conversation like this:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;memory&gt;
</span> 
<span class="k">class</span> <span class="nc">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">NegativeVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Am I glad I don't live in the Arctic! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">PositiveVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"I definitely wouldn't mind catching the Aurora Borealis one day! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Woof. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Meow. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
 
  <span class="n">Cat</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;</span> <span class="n">intelligentCat</span><span class="p">;</span>
  <span class="n">Dog</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;</span> <span class="n">intelligentDog</span><span class="p">;</span>
 
  <span class="n">intelligentDog</span><span class="p">.</span><span class="n">vocalize</span><span class="p">();</span>
  <span class="n">intelligentCat</span><span class="p">.</span><span class="n">vocalize</span><span class="p">();</span>
 
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="p">}</span></code></pre></figure>

<p>This prints out:</p>

<p><code class="highlighter-rouge">Woof. Am I glad I don't live in the Arctic! Meow. I definitely wouldn't mind catching the Aurora Borealis one day!</code>.</p>

<p>See what’s going on here? Cat and Dog now inherit from some generic template parameter T. T can really be any well-formed class, as long as it provides a function intelligentComment(). What’s also great is that we haven’t introduced any sort of hierarchy tree. We could write any number of purely static Vibe classes, and could attach any of them either Dog or Cat (or both) at will. Really consider the implications of this, because they are pretty amazing. Try switching the Vibe template arguments of Cat and Dog. Still works, except they’ve changed their minds.</p>

<p>For example, you can easily nest things to an arbitrary depth. Perhaps your cat wasn’t that impressed by the next episode, but your dog had a change of heart, and also felt like complimenting Sir Attenborough. No problem to switch it up, and add statements:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;memory&gt;
</span> 
<span class="k">class</span> <span class="nc">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">NegativeVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Am I glad I don't live in the Arctic! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">PositiveVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"I definitely wouldn't mind catching the Aurora Borealis one day! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Compliment</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"That David sure is smart. "</span> <span class="o">+</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cutoff</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Woof. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Meow. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
 
  <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span> <span class="n">intelligentCat</span><span class="p">;</span>
  <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Cutoff</span>    <span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span> <span class="n">intelligentDog</span><span class="p">;</span>
 
  <span class="n">intelligentDog</span><span class="p">.</span><span class="n">vocalize</span><span class="p">();</span>
  <span class="n">intelligentCat</span><span class="p">.</span><span class="n">vocalize</span><span class="p">();</span>
 
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="p">}</span></code></pre></figure>

<p>which results in:</p>

<p><code class="highlighter-rouge">Meow. Woof. That David sure is smart. I definitely wouldn't mind catching the Aurora Borealis one day!</code>.</p>

<p>The important thing here is that you can switch PositiveVibe and NegativeVibe, Cutoff and Compliment, and Cat and Dog, and never have to worry about how the functions are being called internally. As long as you write a class that provides the intelligentComment() function, you can write new functionality and chain it arbitrarily deep.</p>

<p>You’ll notice here, though, that we lost one important thing: the ability to store our classes in a polymorphic container. In fact, we’re not related to Animal at all anymore. We’ll quickly fix this in the next section</p>

<h2 id="part-3-using-mixins-in-polymorphic-containers">Part 3: Using mixins in polymorphic containers</h2>

<p>There’s just one easy step we have to make to make our program truly polymorphic:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;memory&gt;
</span> 
<span class="k">class</span> <span class="nc">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">NegativeVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Am I glad I don't live in the Arctic! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">class</span> <span class="nc">PositiveVibe</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"I definitely wouldn't mind catching the Aurora Borealis one day! "</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Compliment</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"That David sure is smart. "</span> <span class="o">+</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cutoff</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">intelligentComment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span><span class="p">,</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Woof. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cat</span><span class="o">:</span> <span class="k">public</span> <span class="n">T</span><span class="p">,</span> <span class="k">public</span> <span class="n">Animal</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">vocalize</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Meow. "</span> <span class="o">&lt;&lt;</span> <span class="n">T</span><span class="o">::</span><span class="n">intelligentComment</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
 
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;&gt;</span> <span class="n">animals</span><span class="p">;</span>
 
  <span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Cutoff</span>    <span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
  <span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">animal</span><span class="o">:</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span> <span class="n">animal</span><span class="o">-&gt;</span><span class="n">vocalize</span><span class="p">();</span> <span class="p">}</span>
 
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="p">}</span></code></pre></figure>

<p>Here we’ve just added one level of multiple inheritance on the outer-most class. Now that we also inherit from Animal, we can store generic pointers to all our different Mixin classes in a single stl container. What a lovely thing that is! All of these different operations are valid:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Cutoff</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Cutoff</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Cutoff</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Cutoff</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">NegativeVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span>
<span class="n">animals</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="o">&lt;</span><span class="n">Compliment</span><span class="o">&lt;</span><span class="n">PositiveVibe</span><span class="o">&gt;&gt;</span><span class="p">());</span></code></pre></figure>

<p>In 45 lines of code, we’ve generated 12 separate classes (or types), that can all be considered Animals. What’s more, we put them all into a dynamically polymorphic container, and called them all with only one virtual function call! That’s incredible. This one virtual call is the compromise I referred to in the introduction, but as you can see its still quite a small one.</p>

<p>This has been a trivial example, but I hope it gets the main point across. With <code class="highlighter-rouge">C++</code> template mixins, we can combine dynamic and static polymorphism under one roof. This is especially useful in designing incredibly complex abstract class hierarchies, where most of the complexity is resolved at compile time, and then conveniently operating on these classes using stl containers.</p>

<p>I’ve made extensive use of this pattern in a code called Salvus, which is a package designed for full waveform modelling and inversion. If you’re interested in seeing just how these patterns might work in the real world, check out <a href="https://github.com/SalvusHub/salvus/blob/master/src/cxx/Element/Element.cpp#L122-L242">these</a> lines, which define a factory function. Here, instead of Dog and Cat, we’re mixing in dynamic physical equations with different types of finite elements. They all get pushed back to a polymorphic container, and get operated on <a href="https://github.com/SalvusHub/salvus/blob/master/src/cxx/Problem/Problem.cpp#L177-L200">here</a>. The package is a work in progress (isn’t it always), but the linked functionality is key to the design.</p>

<p>Next time (next week?) I’ll go over how we manipulate the mixins to allow for some very cool unit tests. Again, this should be applicable to generic problems, but the main example will be based on finite elements. Further down the road, I’ll delve into the highs and lows of shipping mixin classes off to CUDA capable GPUs. And if all goes well, I just might wax poetic about the Artic night myself.</p>

<p>If you’re interested in any of this stuff, please don’t hesitate to send an email.</p>

<p>While learning about <code class="highlighter-rouge">C++</code> mixins, I found these blog posts very helpful: <a href="http://www.drdobbs.com/cpp/mixin-based-programming-in-c/184404445">Dr. Dobbs</a>, <a href="http://www.thinkbottomup.com.au/site/blog/C%20%20_Mixins_-_Reuse_through_inheritance_is_good">ThinkBottomUp</a>.</p>

</div>

<div>
	
	<div class="tbc"></div>
	
</div>

<div class="share">
    <p>Share this post with: </p>
	<a href="https://twitter.com/intent/tweet?text=Combining Static and Dynamic Polymorphism with C++ Mixin classes@jekyllrb&amp;url=http://yourdomain.com/2016/08/03/Combining-Static-and-Dynamic-Polymorphism-with-C++-Mixin-classes.html" class="twitter-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://www.facebook.com/sharer/sharer.php?u=http://yourdomain.com/2016/08/03/Combining-Static-and-Dynamic-Polymorphism-with-C++-Mixin-classes.html" class="facebook-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://plus.google.com/share?url=http://yourdomain.com/2016/08/03/Combining-Static-and-Dynamic-Polymorphism-with-C++-Mixin-classes.html" class="googleplus-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
		</span>
	</a>
</div>


<div id="disqus_thread"></div>


 
</div>


</article>

  </div>

</body>

<foot>

    <footer class="site-footer">

  <div class="wrapper">

    <center>
        
		<p><a class="link" href="/archive/">Archive</a> /
		<a class="link" href="/category/">Category</a> / 
		<a class="link" href="/tags/">Tags</a> / 
		<a class="link" href="/about/">About</a> /
		<a class="link" href="/contact/">Contact</a>
        </p>

        <span><script>document.write(new Date().getFullYear());</script></span>
        <span>&copy;</span>
        
		<a class="link" href=""></a>
		<br>
		<span>Theme &copy; <a class="link" href="https://twitter.com/itisbenjamin1" target="_blank"> Ben</a> | </span>
				<iframe
			style="margin-left: 2px; margin-bottom:-5px;"
			frameborder="0" scrolling="0" width="91px" height="20px"
			src="https://ghbtns.com/github-btn.html?user=itisbenjamin&repo=Nice_Blog&type=star&count=true" >
		</iframe>

    </center>
    
  </div>

</footer>

    <foot>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Derictory -->

  <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<!-- Hit analytics -->

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- Directory -->

<script src="/js/main.js"></script>

</foot>


</foot>

</html>
